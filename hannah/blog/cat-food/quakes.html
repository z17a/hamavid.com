<!--<!DOCTYPE html>
<head>
<html lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>POGO FOOD</title>

    <script type="text/javascript" src="../../../js/d3.js"></script>
    <script type="text/javascript" src="../../../js/crossfilter.js"></script>
	<script type="text/javascript" src="../../../js/dc.js"></script>
	<script type="text/javascript" src="../../../js/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="../../../js/bootstrap.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../../css/dc.css">-->

<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>

  <title>Experiment</title>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src='../../../js/crossfilter.js' type='text/javascript'></script>
  <script src='../../../js/dc.js' type='text/javascript'></script>
  <script src='../../../js/jquery-3.1.1.min.js' type='text/javascript'></script>
  <script src='../../../js/bootstrap.min.js' type='text/javascript'></script>

  <link href='../../../css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <link href='../../../css/dc.css' rel='stylesheet' type='text/css'>

  <style type="text/css"></style>
</head>

</head>
<body>
<div class='container' style='font: 12px sans-serif;'>
<!--barcharts-->
  <div class='row'>
    <div class='span6' id='dc-magnitude-chart'>
      <h4>Events by Magnitude</h4>
    </div>
    <div class='span6' id='dc-depth-chart'>
      <h4>Events by Depth (km)</h4>
    </div>    
  </div>
<!--linechart -->
  <div class='row'>
    <div class='span12' id='dc-time-chart'>
      <h4>Events per hour</h4>
    </div>
  </div>


<!--table--> 
  <div class='row'>
    <div class='span12'>
      <table class='table table-hover' id='dc-table-graph'>
        <thead>
          <tr class='header'>
            <th>DTG</th>
            <th>Lat</th>
            <th>Long</th>
            <th>Depth</th>
            <th>Magnitude</th>
            <th>Google Map</th>
            <th>OSM Map</th>
          </tr>
        </thead>
      </table>
    </div>
  </div>
</div>
<script>

// Create the dc.js chart objects & link to div
var dataTable = dc.dataTable("#dc-table-graph");
var magnitudeChart = dc.barChart("#dc-magnitude-chart");
var depthChart = dc.barChart("#dc-depth-chart");
var timeChart = dc.lineChart("#dc-time-chart");

// load data from a csv file
d3.csv("quakes.csv", function (data) {

  // format our data
  var dtgFormat = d3.time.format("%Y-%m-%dT%H:%M:%S");
  var dtgFormat2 = d3.time.format("%a %e %b %H:%M");

  data.forEach(function(d) { 
    d.dtg   = dtgFormat.parse(d.origintime.substr(0,19)); 
    d.lat   = +d.latitude;
    d.long  = +d.longitude;
    d.mag   = d3.round(+d.magnitude,1);
    d.depth = d3.round(+d.depth,0);
  });

  // Run the data through crossfilter and load our 'facts'
  var facts = crossfilter(data);

  // Magnitude dimension
  var magValue = facts.dimension(function (d) {
    return d.mag;
  });
  var magValueGroupCount = magValue.group()
    .reduceCount(function(d) { return d.mag; }) // counts 

  // Depth dimension
  var depthValue = facts.dimension(function (d) {
    return d.depth;
  });
  var depthValueGroup = depthValue.group();

  // Line chart volume by hour
  var volumeByHour = facts.dimension(function(d) {
    return d3.time.hour(d.dtg);
  });
  var volumeByHourGroup = volumeByHour.group()
    .reduceCount(function(d) { return d.dtg; });


  // Create dataTable dimension
  var timeDimension = facts.dimension(function (d) {
    return d.dtg;
  });

  // Setup the charts
  
  // Bar chart
  magnitudeChart.width(480)
    .height(150)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(magValue)
    .group(magValueGroupCount)
    .transitionDuration(500)
    .centerBar(true)	
    .gap(65)
    .filter([3, 5])
    .x(d3.scale.linear().domain([0.5, 7.5]))
    .elasticY(true)
    .xAxis().tickFormat();	

  // Depth chart
  depthChart.width(480)
    .height(150)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(depthValue)
    .group(depthValueGroup)
    .transitionDuration(500)
    .centerBar(true)	
    .gap(1)  
    .x(d3.scale.linear().domain([0, 100]))
    .elasticY(true)
    .xAxis().tickFormat(function(v) {return v;});

  // time graph
  timeChart.width(960)
    .height(150)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(volumeByHour)
    .group(volumeByHourGroup)
    .transitionDuration(500)
    .brushOn(false)
    .title(function(d) {
      return dtgFormat2(d.key) +  "\nNumber of Events: " + d.value;
      })
    //.x(d3.time.scale().domain([new Date(2013, 6, 18), new Date(2013, 6, 24)]))
    //.x(d3.time.scale().domain([new Date(2013, 7, 8), new Date(2013, 7, 18)]))
    .elasticY(true)
    .x(d3.time.scale().domain(d3.extent(data, function(d) { return d.dtg; })))
    .xAxis();

  // Table of earthquake data
  dataTable.width(960).height(800)
    .dimension(timeDimension)
	.group(function(d) { return "Earthquake Table"
	 })
	.size(100)
    .columns([
      function(d) { return d.dtg; },
      function(d) { return d.lat; },
      function(d) { return d.long; },
      function(d) { return d.depth; },
      function(d) { return d.mag; },
      function(d) { 
          return '<a href=\"http://maps.google.com/maps?z=12&t=m&q=loc:' + 
              d.lat + '+' + d.long + "\" target=\"_blank\">Google Map</a>"},
      function(d) {
          return '<a href=\"http://www.openstreetmap.org/?mlat=' + 
              d.lat + '&mlon=' + d.long +'&zoom=12'+ 
              "\" target=\"_blank\"> OSM Map</a>"}
    ])
    .sortBy(function(d){ return d.dtg; })
    .order(d3.ascending);

  // Render the Charts
  dc.renderAll();
  
});
  
</script>
    
</body>
</html>