<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>

  <title>Pogo</title>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src='../../../js/crossfilter.js' type='text/javascript'></script>
  <script src='../../../js/dc.js' type='text/javascript'></script>
  <script src='../../../js/jquery-3.1.1.min.js' type='text/javascript'></script>
  <script src='../../../js/bootstrap.min.js' type='text/javascript'></script>

  <link href='../../../css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <link href='../../../css/dc.css' rel='stylesheet' type='text/css'>

  <style type="text/css"></style>
</head>

</head>
<body>
<div class='container' style='font: 12px sans-serif;'>
<!--barcharts-->
  <div class='row'>
    <div class='span6' id='dryfood'>
      <h4>Dry food</h4>
    </div>
    <div class='span6' id='wetfood'>
      <h4>Wet food</h4>
    </div>    
  </div>


<!--table--> 
  <div class='row'>
    <div class='span12'>
      <table class='table table-hover' id='alldata'>
        <thead>
          <tr class='header'>
            <th>Date</th>
            <th>Dry</th>
            <th>Wet</th>
          </tr>
        </thead>
      </table>
    </div>
  </div>
</div>
<script>

// Create the dc.js chart objects & link to div
var dataTable = dc.dataTable("#alldata");
var dryfood = dc.lineChart("#dryfood");
var wetfood = dc.lineChart("#wetfood");


// load data from a csv file
d3.csv("d3pogodata.csv", function (data) {

  // format our data
  var dtgFormat = d3.time.format("%m/%d/%y");
  
  data.forEach(function(d) { 
    d.date   = dtgFormat.parse(d.date); 
    d.dry   = +d.dry;
    d.wet  = +d.wet;
  });

  // Run the data through crossfilter and load our 'facts'
  var facts = crossfilter(data);

  // Line charts by day
  var byday = facts.dimension(function(d) {
    return d.date;
  });
  var drygroup = byday.group()
    .reduceSum(function(d) { return d.dry; });
  var wetgroup = byday.group()
    .reduceSum(function(d) { return d.wet; });


  // Create dataTable dimension
  var timeDimension = facts.dimension(function (d) {
    return d.date;
  });

  // Setup the charts
  
  // dry graph
  dryfood.width(480)
    .height(300)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(byday)
    .group(drygroup)
    .transitionDuration(500)
    .elasticY(true)
    .x(d3.time.scale().domain(d3.extent(data, function(d) { return d.date; })))
    .xAxis();

  // wet graph
  wetfood.width(480)
    .height(300)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(byday)
    .group(wetgroup)
    .transitionDuration(500)
    .elasticY(true)
    .x(d3.time.scale().domain(d3.extent(data, function(d) { return d.date; })))
    .xAxis();  

  // Table of all data
  dataTable.width(960).height(800)
    .dimension(timeDimension)
	.group(function(d) { return "All data"
	 })
	.size(100)
    .columns([
      function(d) { return dtgFormat(d.date); },
      function(d) { return d.dry; },
      function(d) { return d.wet; },
    ])
    .sortBy(function(d){ return d.date; })
    .order(d3.ascending);

  // Render the Charts
  dc.renderAll();
  
});
  
</script>
    
</body>
</html>